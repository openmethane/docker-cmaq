C                           DISCLAIMER
C
C   This file was generated by TAMC version 5.3.2
C
C   THE AUTHOR DOES NOT MAKE  ANY WARRANTY, EXPRESS OR IMPLIED, OR ASSUMES
C   ANY LEGAL LIABILITY OR  RESPONSIBILITY FOR THE ACCURACY, COMPLETENESS,
C   OR USEFULNESS  OF ANY INFORMATION OR PROCESS  DISCLOSED, OR REPRESENTS
C   THAT ITS USE WOULD NOT INFRINGE PRIVATELY OWNED RIGHTS.
C
C   THIS CODE IS FOR NON-PROFIT-ORIENTED ACADEMIC RESEARCH AND EDUCATION
C   ONLY.  ANY COMMERCIAL OR OTHER PROFIT-ORIENTED USE OR  EVALUATION IS
C   STRICTLY  FORBIDDEN.  PASSING  THIS CODE  TO  ANY THIRD  PARTY IS  NOT
C   ALLOWED.
C
C   FOR COMMERCIAL OR  OTHER PROFIT-ORIENTED APPLICATIONS PLEASE CONTACT
C   info@FastOpt.com
C
      subroutine vdiff_bwd( cgrid_bwd, cgrid_em_bwd, cgrid_em_sf_bwd,
     &                      jdate, jtime, tstep )
C***************************************************************
C***************************************************************
C** This routine was generated by the                         **
C** Tangent linear and Adjoint Model Compiler,  TAMC 5.3.2    **
C***************************************************************
C***************************************************************

C Revision History:
C   Oct 2010 by Peter Percell at UH-IMAQS: created for adjoint/4dvar
C   Aug 2013 by Peter Percell at UH-IMAQS:
C   -- fixed bug in adjoint for bi-directional flux
C   -- reduced vdiff checkpoint file to just layer 1 of cgrid
C   Nov 2013 S.Capps (US EPA): shifted emissions-related sensitivity
C            arrays to module; incorporated M.Turner (CU-Boulder) 
C            emissions-related sensitivity calculations

      USE PCGRID_DEFN
      USE EMIS_DEFN             ! inherits GRID_CONF
      USE DEPV_DEFN
      USE VDIFF_MAP
      USE CHK_FILES_DEFS        ! adjoint checkpoint files definition
      USE CHK_FILES             ! adjoint checkpoint files routines
      USE ADJ_ARRAY_MOD         ! adjoint sensitivity arrays
      !USE EMIS_DEFN, ONLY : EMSENSL

C==============================================
C all entries are defined explicitly
C==============================================
      IMPLICIT NONE

      INCLUDE SUBST_CONST       ! constants
      INCLUDE SUBST_FILES_ID    ! file name parameters
      INCLUDE SUBST_IOPARMS     ! I/O parameters definitions
#     INCLUDE SUBST_IODECL      ! I/O definitions and declarations

C Arguments:

      REAL, POINTER :: CGRID_BWD( :,:,:,: ) ! sensitivities of J w.r.t. concentration
!      Now defining these pointers inside the adj_array_mod
      REAL, POINTER :: CGRID_EM_BWD( :,:,:,: ) ! sensitivities of J w.r.t. emissions
      REAL, POINTER :: CGRID_EM_SF_BWD( :,:,:,: ) ! sensitivities of J w.r.t. emissions multiplied by emissions
 
      INTEGER :: JDATE          ! current model date, coded YYYYDDD
      INTEGER :: JTIME          ! current model time, coded HHMMSS
      INTEGER :: TSTEP( 2 )     ! time step vector (HHMMSS)
                                ! TSTEP(1) = local output step
                                ! TSTEP(2) = sciproc sync. step (chem)

C Local Variables:

      LOGICAL, SAVE :: FIRSTIME = .TRUE.
      INTEGER, SAVE :: LOGDEV

      CHARACTER( 16 ), SAVE :: PNAME = 'VDIFFACM2_BWD'
      CHARACTER( 120 ) :: XMSG = ' '

C-----------------------------------------------------------------------

      IF ( FIRSTIME ) THEN

         FIRSTIME = .FALSE.
         LOGDEV = INIT3()

      END IF                    ! FIRSTIME

      end subroutine vdiff_bwd
